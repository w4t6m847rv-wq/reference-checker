<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CELE Academic Writing Assistant</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #1a2a6c, #2c3e50); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); overflow: hidden; }
        .header { background: linear-gradient(135deg, #2c3e50, #3498db); color: white; padding: 25px; text-align: center; }
        .chat-container { height: 50vh; padding: 15px; overflow-y: auto; background: #f8f9fa; border-bottom: 1px solid #e9ecef; }
        .message { margin-bottom: 12px; padding: 10px 14px; border-radius: 15px; max-width: 85%; line-height: 1.4; animation: fadeIn 0.3s ease; }
        .user-message { background: #3498db; color: white; margin-left: auto; }
        .assistant-message { background: #e9ecef; margin-right: auto; }
        .input-area { padding: 15px; background: white; }
        .input-group { display: flex; gap: 8px; }
        #user-input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 20px; font-size: 16px; }
        #send-btn { padding: 12px 20px; background: #3498db; color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 16px; }
        .thinking { display: none; text-align: center; color: #7f8c8d; margin: 8px 0; }
        .welcome-message { text-align: center; padding: 15px; background: #e3f2fd; border-radius: 10px; margin-bottom: 15px; }
        .suggestion { background: white; border: 1px solid #3498db; color: #3498db; padding: 6px 12px; border-radius: 15px; cursor: pointer; font-size: 13px; margin: 2px; }
        .disclaimer { padding: 8px 15px; background: #fff3cd; color: #856404; font-size: 11px; text-align: center; border-top: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>CELE Academic Writing Assistant</h1>
            <p>Harvard Referencing Help - University of Nottingham</p>
        </div>
        
        <div class="chat-container" id="chat-container">
            <div class="welcome-message">
                <h3>Welcome! ðŸŽ“</h3>
                <p>I can help you check your Harvard references for the IWA assignment</p>
                <div class="suggested-questions">
                    <div class="suggestion" onclick="checkExample('book-chapter')">Check Book Chapter</div>
                    <div class="suggestion" onclick="checkExample('book')">Check Book</div>
                    <div class="suggestion" onclick="checkExample('journal')">Check Journal Article</div>
                </div>
            </div>
        </div>
        
        <div class="thinking" id="thinking">Checking your reference...</div>
        
        <div class="input-area">
            <div class="input-group">
                <input type="text" id="user-input" placeholder="Paste your reference here for checking..." autocomplete="off">
                <button id="send-btn" onclick="sendMessage()">Check Reference</button>
            </div>
        </div>
        
        <div class="disclaimer">
            CELE Citation Guide & IWA Reading List - For educational use at University of Nottingham
        </div>
    </div>

    <script>
        const API_URL = 'https://reference-checker-83yl.onrender.com/check-reference';

        const examples = {
            'book-chapter': "Mattes, R. D. and Tan, S. Y. (2014) 'Obesity: The influence of the food environment on ingestive behaviours', in Bray, G. A. and Bouchard, C. (eds.) Handbook of Obesity: Epidemiology, Etiology, and Physiopathology. London: CRC Press.",
            'book': "Eilender, E. (2016) Public health and community nutrition. New York: Momentum Press.",
            'journal': "Caso, D. et al. (2020) Unhealthy eating and academic stress. Health Psychology Open, 7(2), 1-15."
        };

        function checkExample(type) {
            document.getElementById('user-input').value = examples[type];
            document.getElementById('user-input').focus();
        }

        function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;
            
            addMessage(message, 'user');
            input.value = '';
            document.getElementById('thinking').style.display = 'block';
            document.getElementById('send-btn').disabled = true;
            
            const xhr = new XMLHttpRequest();
            xhr.open('POST', API_URL, true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    document.getElementById('thinking').style.display = 'none';
                    document.getElementById('send-btn').disabled = false;
                    
                    if (xhr.status === 200) {
                        try {
                            const data = JSON.parse(xhr.responseText);
                            if (data.success) {
                                addMessage(data.response, 'assistant');
                            } else {
                                addMessage("Error: " + (data.error || 'Unknown error'), 'assistant');
                            }
                        } catch (e) {
                            addMessage("Error parsing response", 'assistant');
                        }
                    } else {
                        addMessage("Connection failed. Status: " + xhr.status, 'assistant');
                    }
                }
            };
            
            xhr.onerror = function() {
                document.getElementById('thinking').style.display = 'none';
                document.getElementById('send-btn').disabled = false;
                addMessage("Network error. Please check your connection.", 'assistant');
            };
            
            xhr.send(JSON.stringify({ message: message }));
        }

        function addMessage(text, sender) {
            const container = document.getElementById('chat-container');
            const msg = document.createElement('div');
            msg.className = `message ${sender}-message`;
            msg.textContent = text;
            container.appendChild(msg);
            container.scrollTop = container.scrollHeight;
        }

        document.getElementById('user-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendMessage();
        });

        setTimeout(() => {
            addMessage("Hello! I can help you check your Harvard references. Paste your reference and I'll give you feedback.", 'assistant');
        }, 1000);
    </script>
</body>
</html>
